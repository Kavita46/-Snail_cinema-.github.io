<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="referrer" content="no-referrer" />
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <script src="../js/1.js"></script>
  <script src="   ../js/jquery-3.6.0.min.js"></script>
  <link href="../css/public.css" rel="stylesheet">
  <link href="../css/3-register.css" rel="stylesheet">
</head>

<body>
  <header>
    <div class="icon-2"></div>
    <a href="7-my.html">
      <div class="arrow-back">
      </div>
    </a>

  </header>

  <div class="main">
    <div class="input-box">
      <div class="input-name">用户名</div>
      <input type="text" class="input-item item-1" placeholder="Randy" />
    </div>
    <div class="input-box">
      <div class="input-name">密码</div>
      <input type="text" class="input-item item-2" placeholder="·········" />
    </div>

    <div class="input-box">
      <div class="input-name">确认密码</div>
      <input type="text" class="input-item item-3" placeholder="·········">
      <div class="eye"></div>
    </div>

  </div>

  <div class="button-blue" id="register_btn">

    <h2>立即注册</h2>
    <!-- <a href = "4-login.html">立即注册</a> -->
  </div>

  </div>

  <script>

    // var localStorage = window.localStorage;
    $("#register_btn").click(function () {

      var username = $(".item-1").val();
      var password = $(".item-2").val();
      var password_confirm = $(".item-3").val();

      if (username == null || username == "") {
        alert("用户名不能为空");
        return;
      };

      if (password == null || password == "") {
        alert("密码不能为空");
        return;
      };
      if (password_confirm == null || password_confirm == "") {
        alert("确认密码不能为空");
        return;
      }

      if (password_confirm != password) {
        alert("两次密码不一致");
        return;
      } else {
        var user = {
          username: username,
          password: password
        };

        // console.log(localStorage.getItem("users"));

        if (localStorage.getItem("users") == null) {
          var users = [];
          console.log("users空");
        } else {
          var users = JSON.parse(localStorage.getItem("users"));
          console.log("已有users");
        }

        var hasUser = false;

        // 判断是否存在
        users.find(function (item, index) {
          if (item.username == username) {
            alert("用户名已存在,不能重复注册");
            hasUser = true;
            return;
          }

        });

        if(!hasUser){
          users.push(user);
          localStorage.setItem("users", JSON.stringify(users));
          alert("注册成功");
          console.log(localStorage.getItem("users"));

          location.href = "4-login.html";
        }
      }

    });


  </script>
</body>

</html>